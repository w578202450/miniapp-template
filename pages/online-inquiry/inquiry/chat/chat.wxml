<view class="page">
  <!-- 顶部 -->
  <view class="body-view">
    <loading hidden="{{hidden}}" bindchange="loadingChange">
      加载中...
    </loading>
  </view>
  <view class="middle-one">
    <view class="middleOne-box middleOne-box-one" bindtap="doctorDetailTap" data-index="0">
      <view class="headDiv">
        <image class="headImg" src="{{talkInfo.doctorInfo.faceImage}}" />
        <image class="headImgBac" src="../../../../images/chat/personBacImg.png" />
      </view>
      <view class="info-box">
        <view class="flexRowStartCenter">
          <view class="info_one">{{talkInfo.doctorInfo.doctorName}}</view>
          <text class="info_one_one">医生</text>
        </view>
        <text class="info_two">主任医师</text>
      </view>
    </view>
    <view class="middleOne-box" bindtap="doctorDetailTap" data-index="1">
      <view class="headDiv">
        <image class="headImg" src="{{talkInfo.assistantInfo.faceImage}}" />
        <image class="headImgBac" src="../../../../images/chat/personBacImg.png" />
      </view>
      <view class="info-box">
        <view class="flexRowStartCenter">
          <view class="info_one">{{talkInfo.assistantInfo.doctorName}}</view>
          <text class="info_one_one">医助</text>
        </view>
        <text class="info_two">助理医师</text>
      </view>
    </view>
  </view>
  <!-- 消息列表 -->
  <!-- <scroll-view class="{{isOpenBottomBoolbar ? 'message-list-two': 'message-list'}}" scroll-into-view="{{toView}}" scroll-with-animation="true" upper-threshold="100" scroll-y="true" enable-back-to-top="true" bindscrolltoupper="getHistoryMessageNext" bindtap="clickScrollViewFun"> -->
  <!-- 空置盒子1 -->
  <view class="marginBoxOne"></view>
  <view id="viewCommunicationBody" bindtap="clickViewCommunicationFun">
    <view class="row" wx:for="{{currentMessageList}}" wx:key="{{index}}" id="item{{index}}">
      <!-- 日期 -->
      <view class="datetime" wx:if="{{item.addTime}}">{{item.addTime}}</view>
      <!-- 头像与内容文本 -->
      <view class="body" style="flex-flow: {{item.from == talkInfo.multiTalkInfo.patientID ? 'row-reverse': 'row'}}">
        <view class="avatar-container">
          <!-- 患者头像 -->
          <view wx:if="{{item.from == talkInfo.multiTalkInfo.patientID}}" class="personHeadImgDiv">
            <image wx:if="{{!talkInfo.patientInfo.faceImage}}" class="personHeadImgBac" src="../../../../images/chat/personBacImg.png" />
            <image ex:else src="{{talkInfo.patientInfo.faceImage}}" class="avatarTwo" />
          </view>
          <!-- 医生头像 -->
          <view wx:elif="{{item.from == talkInfo.multiTalkInfo.doctorStaffID}}" class="personHeadImgDiv">
            <image wx:if="{{!talkInfo.doctorInfo.faceImage}}" class="personHeadImgBacTwo" src="../../../../images/chat/personBacImg.png" />
            <image src="{{talkInfo.doctorInfo.faceImage}}" class="avatarOne" />
          </view>
          <!-- 医助头像 -->
          <view wx:elif="{{item.from == talkInfo.multiTalkInfo.assistantStaffID}}" class="personHeadImgDiv">
            <image wx:if="{{!talkInfo.assistantInfo.faceImage}}" class="personHeadImgBacTwo" src="../../../../images/chat/personBacImg.png" />
            <image src="{{talkInfo.assistantInfo.faceImage}}" class="avatarOne" />
          </view>
        </view>
        <!-- 画对话框 -->
        <view>
          <view wx:if="{{item.from != talkInfo.multiTalkInfo.patientID}}" class="personNameTxt">
            <text wx:if="{{item.from == talkInfo.multiTalkInfo.doctorStaffID}}">{{talkInfo.doctorInfo.doctorName}} -医生</text>
            <text wx:elif="{{item.from == talkInfo.multiTalkInfo.assistantStaffID}}">{{talkInfo.assistantInfo.doctorName}} -医助</text>
          </view>
          <!-- 文本消息：TIMTextElem -->
          <view wx:if="{{item.type == 'TIMTextElem'}}" class="contentTxtMsg" style="{{item.from == talkInfo.multiTalkInfo.patientID ? 'background: #B6D1F9' : ''}};min-width: 35rpx;min-height: 45rpx;">
            <view>{{item.payload.text}}</view>
          </view>
          <!-- 图片消息：TIMImageElem -->
          <view wx:elif="{{item.type == 'TIMImageElem'}}" class="contentPictureMsg" style="{{item.from == talkInfo.multiTalkInfo.patientID ? 'background: #B6D1F9' : ''}}" bindtap="previewImage" data-imagesrc="{{item.payload.imageInfoArray[0].imageUrl}}">
            <!-- <image wx:if="{{item.showLoadingState}}" src="../../../../images/chat/loading-fail.png" class="imageLoading"/> -->
            <weui-loading wx:if="{{item.showLoadingState}}" class="imageLoading" type="circle" tips="{{tips}}"></weui-loading>
            <image class="pictureMsg" src="{{item.payload.imageInfoArray[0].imageUrl}}" />
          </view>
          <!-- 音频消息：TIMSoundElem -->
          <view wx:elif="{{item.type == 'TIMSoundElem'}}" class="contentVideoMsg" style="{{item.from == talkInfo.multiTalkInfo.patientID ? 'background: #B6D1F9' : ''}}" bindtap="playRecordFun" data-recordurl="{{item.payload.url}}"  data-recordindex="{{index}}">
            <!-- 自己发的 -->
            <view wx:if="{{item.from == talkInfo.multiTalkInfo.patientID}}" class="recordDivSelf" style="width: {{item.recordViewWidth}}rpx;">
              <view class="_div data-v-71681a0a">{{item.payload.second}}"</view>
              <image wx:if="{{item.recordStatus}}" src="{{recordIconClickedUrlSelf}}" class="payloadImage"></image>
              <image wx:else src="{{recordIconUrlSelf}}" class="payloadImage"></image>
            </view>
            <!-- 别人发的 -->
            <view wx:else class="recordDiv" style="width: {{item.recordViewWidth}}rpx;">
              <image wx:if="{{item.recordStatus}}" src="{{recordIconClickedUrlOthers}}" class="payloadImage"></image>
              <image wx:else src="{{recordIconUrlOthers}}" class="payloadImage"></image>
              <view class="_div data-v-71681a0a">{{item.payload.second}}"</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- 空置盒子2 -->
  <view class="{{isOpenBottomBoolbar ? 'marginBoxTwoSecond': 'marginBoxTwo'}}"></view>
  <!-- </scroll-view> -->
  <!-- 底部菜单栏 -->
  <view class="bottomMenus">
    <view class="reply">
      <view class="opration-area">
        <!-- 切换键盘 -->
        <image wx:if="{{isSendRecord}}" src="../../../../images/chat/jianpan.png" class="voiceIcon" bindtap="openKeyboardFun" />
        <!-- 切换语音 -->
        <image wx:else src="../../../../images/chat/voiceIcon.png" class="voiceIcon" bindtap="willSendRecordMsg" />
        <!-- 录音按钮 -->
        <text wx:if="{{isSendRecord}}" class="recordBtn" bindtouchstart="handleTouchStart" bindtouchend="handleTouchEnd" bindlongpress="handleLongPress" bindtouchmove="handleMove" bindtap="handleClick">{{recordingTxt}}</text>
        <!-- 文本输入框 -->
        <input wx:else class="msgInput" type="text" value="{{maySendContent}}" confirm-type="send" bindinput="adInputChange" bindconfirm="sendContentMsg" bindfocus="closeBottomBoolbarFun" style="width: {{!isSendRecord && maySendContentSure ? '470': '515'}}rpx;"/>
<!-- bindfocus="closeBottomBoolbarFun" style="width: {{!isSendRecord && maySendContentSure ? '400': '445'}}rpx;"/> -->
        <!-- 表情 -->
        <!-- <image src="../../../../images/chat/inputIcon.png" class="inputIcon" /> -->
      </view>
      <!-- 菜单、发送按钮 -->
      <view class="send">
        <image wx:if="{{isOpenBottomBoolbar}}" src="../../../../images/chat/m-close.png" class="menusIcon" bindtap="isOpenBottomBoolbarFun" />
        <view wx:elif="{{!isSendRecord && maySendContentSure}}" class="sendContentMsgBtn" bindtap="sendContentMsg">发送</view>
        <image wx:else src="../../../../images/chat/menusIcon.png" class="menusIcon" bindtap="isOpenBottomBoolbarFun" />
      </view>
    </view>
    <!-- 功能区 -->
    <view wx:if="{{isOpenBottomBoolbar}}" class="toolbarBox">
      <view wx:for="{{toolbarMenus}}" wx:key="{{item.keyID}}" class="{{item.isFifth ? 'toolbarDivFifth' : 'toolbarDiv'}}" bindtap="toolbarMenusFun" data-clickFun="{{item.clickFun}}">
        <image src="{{item.iconUrl}}" class="toolbarIcon" />
        <view class="toolbarTitile">{{item.title}}</view>
      </view>
    </view>
  </view>
</view>